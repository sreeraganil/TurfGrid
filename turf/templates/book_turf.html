{% extends "base.html" %}

{% block title %}Book {{ turf.name }} - TurfGrid{% endblock %}

{% block content %}
<div class="min-h-screen bg-purple-500 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Booking Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">Book {{ turf.name }}</h1>
      <p class="text-lg text-gray-900">Complete your booking details below</p>
    </div>

    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="p-6 md:p-8">
        <!-- Turf Info -->
        <div class="flex flex-col md:flex-row gap-6 mb-8">
          {% if turf.image %}
          <div class="w-full md:w-1/3">
            <img src="{{ turf.image.url }}" alt="{{ turf.name }}" class="w-full h-auto rounded-lg object-cover">
          </div>
          {% endif %}
          <div class="flex-1">
            <h2 class="text-xl font-bold text-gray-900 mb-2">{{ turf.name }}</h2>
            <div class="flex items-center text-gray-600 mb-2">
              <svg class="h-5 w-5 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span>{{ turf.location }}</span>
            </div>
            <div class="flex items-center text-gray-600 mb-4">
              <svg class="h-5 w-5 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>{{ turf.opening|time:"H:i" }} - {{ turf.closing|time:"H:i" }}</span>
            </div>
            <div class="bg-purple-50 p-3 rounded-lg">
              <div class="flex justify-between">
                <span class="font-medium">Price per hour:</span>
                <span class="font-bold">₹{{ turf.price_per_hour|floatformat:0 }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Form -->
        <form method="POST" action="{% url 'book_turf' turf.id %}" class="space-y-6">
          {% csrf_token %}
          
          <!-- Date Selection -->
          <div>
            <label for="booking_date" class="block text-sm font-medium text-gray-700 mb-1">Booking Date</label>
            <input type="date" name="booking_date" id="booking_date"
                    min="{{ today|date:'Y-m-d' }}"
                    value="{{ values.booking_date }}"
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500"
                    required
                    onchange="handleDateChange(this.value)">
            </div>

            <script>
            function handleDateChange(date) {
                if (!date) return;
                const url = `{% url 'book_turf' turf.id %}?booking_date=${date}`;
                window.location.href = url;
            }
            </script>

          <!-- Time Selection -->
          <div>
            <label for="start_time" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
            <select name="start_time" id="start_time" 
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500"
                    required>
              {% for hour in available_hours %}
                <option value="{{ hour|time:'H:i' }}">{{ hour|time:"H:i" }}</option>
                {% empty %}
                <option value="">Not Available</option>
              {% endfor %}
            </select>
          </div>

          <!-- Duration Selection -->
          <div>
            <label for="duration" class="block text-sm font-medium text-gray-700 mb-1">Duration (hours)</label>
            <select name="duration" id="duration" 
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500"
                    required>
              {% for i in duration_options %}
                <option value="{{ i }}" {% if i == turf.minimum_booking_duration %}selected{% endif %}>
                  {{ i }} hour{{ i|pluralize }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- Price Calculation -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Base price</span>
              <span class="font-medium">₹{{ turf.price_per_hour|floatformat:0 }}/hour</span>
            </div>
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Duration</span>
              <span id="duration-display" class="font-medium">{{ turf.minimum_booking_duration }} hour{{ turf.minimum_booking_duration|pluralize }}</span>
            </div>
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Service fee</span>
              <span class="font-medium">₹80</span>
            </div>
            <div class="flex justify-between py-3 border-t border-gray-200 mt-2">
              <span class="font-medium">Total Amount</span>
              <span id="total-amount" class="font-bold text-lg">
                ₹{{ turf.price_per_hour|add:"80"|floatformat:0 }}
              </span>
            </div>
          </div>

          <!-- Additional Notes -->
          <div>
            <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Additional Notes (Optional)</label>
            <textarea name="notes" id="notes" rows="3" 
                      class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500"></textarea>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200">
            Confirm Booking
          </button>

          <!-- Cancellation Policy -->
          <p class="text-xs text-gray-500 text-center mt-3">
            <svg class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            Free cancellation up to 24 hours before booking
          </p>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const durationSelect = document.getElementById('duration');
  const durationDisplay = document.getElementById('duration-display');
  const totalAmountDisplay = document.getElementById('total-amount');
  const pricePerHour = {{ turf.price_per_hour }};
  const serviceFee = 80;

  function updateBookingDetails() {
    const duration = parseInt(durationSelect.value);
    const totalAmount = (pricePerHour * duration) + serviceFee;
    
    durationDisplay.textContent = duration + ' hour' + (duration !== 1 ? 's' : '');
    totalAmountDisplay.textContent = '₹' + totalAmount.toFixed(0);
  }

  durationSelect.addEventListener('change', updateBookingDetails);
  
  // Initialize on load
  updateBookingDetails();
});
</script>
{% endblock %}